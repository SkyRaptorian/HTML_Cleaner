### A tool to clean up html files generated by LibreOffice Writer into xhtml files for the creation of an epub using Beautiful Soup.
### AUTHOR: SkyRaptorian
### CREATION DATE: 10 AUG 2023
### MODIFIED DATE: 11 AUG 2023

#IMPORTS
from bs4 import BeautifulSoup
from bs4 import Comment

from htmlManager import cleanHTML
from book import book
from formatReader import readFormat

import os.path
import re

#File Names and counters -----------------------------------------------------------------------

chapterCount = 1
chapterPath = "../Chapter {}.html"
final_path = "final/chapter-{}.xhtml"

add_parts = {"../Epilogue.html":"final/epilogue.xhtml"} #List for any additional non-numbered chapters

#Dictionary and Arrays
#linebreak = "###" #the in text place holder for the line break - in <p> text
#style_rules = { #dictionary of css style rules and where they are getting added, match with css
#  "h1": "chapHeading",
#  "body": "chapter"
#}

if os.path.exists("format/palelights.txt"):
  readFile = open("format/palelights.txt")
  thisBook = readFormat(readFile)
else:
  print("Error: Format does not exist")
  exit()

#thisBook = book(bookTitle, chapterName, linebreak, style_rules) #create book with information
#print("Swapping!")
#Loop for incremental value (until it runs out of numbered chapters)
while os.path.exists(chapterPath.format(chapterCount)): #While a chapter exists continue
    chapter = open(chapterPath.format(chapterCount))
    soup = BeautifulSoup(chapter, 'html.parser') #Create soup

    cleanHTML(soup, thisBook, chapterCount)

    #Create output files
    output = open(final_path.format(chapterCount), "w")
    soup.encode(formatter="html")
    output.write(str(soup))

    #Close files
    chapter.close()
    output.close()

    chapterCount += 1 #increment chapter count

for path in add_parts:
  if os.path.exists(path): #While a chapter exists continue
    chapter = open(path)
    soup = BeautifulSoup(chapter, 'html.parser') #Create soup

    cleanHTML(soup, thisBook, "ADDITIONAL")

    #Create output files
    output = open(add_parts[path], "w")
    soup.encode(formatter="html")
    output.write(str(soup))

    #Close files
    chapter.close()
    output.close()
